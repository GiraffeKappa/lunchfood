<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£Ÿç¥é»é¤å–® - è½‰è§’é˜¿å§¨ä¾¿ç•¶</title>
    <style>
        /* --- æ¨£å¼è¨­å®š (ä¿æŒåŸæœ¬é¢¨æ ¼) --- */
        :root {
            --appetite-orange: #FF6B35;
            --bg-cream: #FFF8F0;
            --text-dark: #4A2C2A;
        }
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-cream);
            color: var(--text-dark);
            margin: 0; padding: 20px;
            display: flex; justify-content: center;
        }
        .container {
            width: 100%; max-width: 500px;
            background: white; border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); overflow: hidden;
        }
        .header {
            background: var(--appetite-orange); color: white;
            padding: 20px; text-align: center;
        }
        .header h1 { margin: 0; font-size: 1.5rem; }
        
        /* èœå–®å€ */
        .menu-section { padding: 20px; }
        .menu-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px; border-bottom: 1px solid #eee; cursor: pointer;
            transition: background 0.2s; border-radius: 8px;
        }
        .menu-item:hover { background-color: #fff3e0; }
        .menu-item.selected { background-color: #ffe0b2; border: 2px solid var(--appetite-orange); }
        .price { color: #d32f2f; font-weight: bold; }

        /* è¼¸å…¥å€ */
        .input-section { padding: 20px; background: #fafafa; border-top: 2px dashed #ddd; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select {
            width: 100%; padding: 10px; border: 1px solid #ccc;
            border-radius: 8px; box-sizing: border-box; font-size: 1rem;
        }

        /* æŒ‰éˆ• */
        .submit-btn {
            width: 100%; padding: 15px; background: var(--text-dark);
            color: #F7C800; border: none; border-radius: 50px;
            font-size: 1.2rem; font-weight: bold; cursor: pointer;
        }
        .submit-btn:disabled { background: #ccc; color: #666; cursor: not-allowed; }

        /* æˆåŠŸæç¤º */
        #success-msg {
            display: none; text-align: center; padding: 20px;
            color: green; font-weight: bold; background: #e8f5e9;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>ğŸ± ä»Šå¤©åƒï¼šè½‰è§’é˜¿å§¨ä¾¿ç•¶</h1>
        <p>è«‹é»é¸é¤é»ä¸¦é€å‡ºï¼Œæ–¹ä¾¿çµ±è¨ˆï¼</p>
    </div>

    <div class="menu-section">
        <h3>1. é¸æ“‡é¤é»</h3>
        
        <div class="menu-item" onclick="selectFood('æ‹›ç‰Œæ’éª¨é£¯', 100, this)">
            <div>æ‹›ç‰Œæ’éª¨é£¯</div><div class="price">$100</div>
        </div>
        
        <div class="menu-item" onclick="selectFood('é…¥ç‚¸é›è…¿é£¯', 110, this)">
            <div>é…¥ç‚¸é›è…¿é£¯</div><div class="price">$110</div>
        </div>
        
        <div class="menu-item" onclick="selectFood('å¤æ—©å‘³æ»·è‚‰é£¯', 55, this)">
            <div>å¤æ—©å‘³æ»·è‚‰é£¯</div><div class="price">$55</div>
        </div>
        
        <div class="menu-item" onclick="selectFood('é¦™ç…é¯–é­šé£¯', 120, this)">
            <div>é¦™ç…é¯–é­šé£¯</div><div class="price">$120</div>
        </div>
    </div>

    <div class="input-section">
        <h3>2. å¡«å¯«è³‡æ–™</h3>
        <div class="form-group">
            <label>ä½ çš„åå­— (å¿…å¡«)</label>
            <input type="text" id="username" placeholder="ä¾‹ï¼šå°æ˜">
        </div>
        <div class="form-group">
            <label>å‚™è¨» (é¸å¡«)</label>
            <input type="text" id="note" placeholder="ä¾‹ï¼šä¸è¦é¦™èœã€é£¯å°‘">
        </div>
        
        <button class="submit-btn" id="btnSubmit" onclick="submitOrder()">ğŸš€ ç¢ºèªé€å‡ºè¨‚å–®</button>
    </div>

    <div id="success-msg">
        âœ… è¨‚è³¼æˆåŠŸï¼<br>å·²å¯«å…¥é£Ÿç¥å¸³æœ¬
    </div>
</div>

<script>
    // âš ï¸ é€™è£¡ä¹Ÿè¦å¡«å…¥æ­£ç¢ºçš„ GAS ç¶²å€
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwxqBOM8VD1mZwXGfctdItrDxWs8AIxjZ38Ye9BgEPvmBzp_V2SSCaXAAAbt_fCiYI/exec"; 

    let currentMenuId = ""; // ç”¨ä¾†å­˜ç¾åœ¨æ˜¯å“ªå€‹èœå–®
    let selectedItem = "";
    let selectedPrice = 0;

    // é é¢è¼‰å…¥æ™‚ï¼ŒæŠ“å–ç¶²å€ä¸Šçš„ ID
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        currentMenuId = urlParams.get('id');

        if (!currentMenuId) {
            document.querySelector('.menu-section').innerHTML = "<h3>âš ï¸ ç„¡æ³•è¼‰å…¥èœå–®</h3><p>ç¶²å€ç¼ºå°‘ IDï¼Œè«‹ç”±ç®¡ç†å“¡æä¾›çš„é€£çµé€²å…¥ã€‚</p>";
            return;
        }

        loadMenu(currentMenuId);
    };

    // å‘ GAS è«‹æ±‚èœå–®è³‡æ–™
    function loadMenu(menuId) {
        document.querySelector('.menu-section').innerHTML = "<h3>â³ èœå–®è¼‰å…¥ä¸­...</h3>";
        
        fetch(`${SCRIPT_URL}?action=get_menu&id=${encodeURIComponent(menuId)}`)
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                // æ›´æ–°æ¨™é¡Œ
                document.querySelector('.header h1').innerText = `ğŸ± ä»Šå¤©åƒï¼š${data.title.split('_')[1]}`; // å»æ‰æ™‚é–“æˆ³è¨˜
                
                // å‹•æ…‹ç”¢ç”Ÿèœå–® HTML
                const menuContainer = document.querySelector('.menu-section');
                menuContainer.innerHTML = '<h3>1. é¸æ“‡é¤é»</h3>'; // æ¸…ç©º loading
                
                data.items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'menu-item';
                    div.onclick = function() { selectFood(item.name, item.price, this); };
                    div.innerHTML = `<div>${item.name}</div><div class="price">$${item.price}</div>`;
                    menuContainer.appendChild(div);
                });
            } else {
                document.querySelector('.menu-section').innerHTML = `<h3>âŒ éŒ¯èª¤</h3><p>${data.message}</p>`;
            }
        })
        .catch(err => {
            document.querySelector('.menu-section').innerHTML = "<h3>âŒ é€£ç·šå¤±æ•—</h3><p>è«‹æª¢æŸ¥ç¶²è·¯</p>";
        });
    }

    function selectFood(name, price, element) {
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        selectedItem = name;
        selectedPrice = price;
    }

    function submitOrder() {
        const name = document.getElementById('username').value;
        const note = document.getElementById('note').value;
        const btn = document.getElementById('btnSubmit');

        if (!name) { alert("è«‹è¼¸å…¥åå­—ï¼"); return; }
        if (!selectedItem) { alert("è«‹é¸æ“‡ä¸€ä»½é¤é»ï¼"); return; }

        btn.disabled = true;
        btn.innerText = "è³‡æ–™å‚³é€ä¸­...";

        const orderData = {
            action: "order", // å‘Šè¨´å¾Œç«¯é€™æ˜¯è¨‚å–®
            menuId: currentMenuId, // é‡è¦ï¼å‘Šè¨´å¾Œç«¯è¦å¯«å…¥å“ªå€‹åˆ†é 
            name: name,
            item: selectedItem,
            price: selectedPrice,
            note: note
        };

        // é€™è£¡ä¸éœ€è¦ no-corsï¼Œå› ç‚ºå¾Œç«¯ç¾åœ¨æ”¯æ´ CORS å›å‚³
        fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify(orderData)
        }).then(res => res.json())
        .then(json => {
            if (json.status === "success") {
                document.querySelector('.input-section').style.display = 'none';
                document.querySelector('.menu-section').style.display = 'none';
                document.getElementById('success-msg').style.display = 'block';
            } else {
                alert("è¨‚è³¼å¤±æ•—ï¼š" + json.message);
                btn.disabled = false;
            }
        }).catch(error => {
            alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
            btn.disabled = false;
        });
    }
</script>

</body>

</html>
