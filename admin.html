<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ï¸ é£Ÿç¥æ§åˆ¶ä¸­å¿ƒ</title>
    <style>
        /* --- ğŸ¨ æ·ºè‰²ä¸»é¡Œé…è‰² --- */
        :root {
            --bg-light: #f4f7f6;      /* æ•´é«”èƒŒæ™¯ */
            --card-bg: #ffffff;       /* å¡ç‰‡èƒŒæ™¯ */
            --text-main: #333333;     /* ä¸»è¦æ–‡å­— */
            --text-sub: #666666;      /* æ¬¡è¦æ–‡å­— */
            --gold: #F7C800;          /* å¼·èª¿è‰² (é‡‘) */
            --orange: #FF6B35;        /* å¼·èª¿è‰² (æ©˜) */
            --header-bg: #ffffff;     /* æ¨™é¡Œåˆ—èƒŒæ™¯ */
            --nav-bg: #ffffff;        /* å°è¦½åˆ—èƒŒæ™¯ */
            --border-color: #e0e0e0;  /* é‚Šæ¡†é¡è‰² */
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-main);
            margin: 0; padding: 0;
            padding-bottom: 80px;
        }

        /* é ‚éƒ¨æ•¸æ“šåˆ— */
        .dashboard-header {
            background: var(--header-bg);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--orange);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .total-stats { display: flex; justify-content: space-around; margin-top: 15px; }
        .stat-box .num { font-size: 1.8rem; font-weight: 800; color: var(--orange); }
        .stat-box .label { font-size: 0.9rem; color: var(--text-sub); }

        /* é€šç”¨å®¹å™¨èˆ‡å¡ç‰‡ */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s; max-width: 800px; margin: 0 auto; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
        .card-box { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h3.tab-title { color: var(--orange); margin-top: 0; border-left: 4px solid var(--orange); padding-left: 10px;}
<div style="margin: 15px 0;">
    <input type="checkbox" id="save-pool-check" checked>
    <label for="save-pool-check" style="cursor:pointer; color:var(--text-main);">åŒæ™‚å°‡æ­¤èœå–®å­˜å…¥ã€Œä¾¿ç•¶æ± ã€ï¼Œä¸‹æ¬¡å¯ç›´æ¥é¸ç”¨</label>
</div>
        /* --- æ–°å¢ï¼šç™¼å¸ƒåœ˜è³¼ (Create Menu) --- */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--text-main); }
        .input-field { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; font-size: 1rem; transition: border 0.3s;}
        .input-field:focus { border-color: var(--orange); outline: none; }
        
        .menu-editor-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .menu-editor-item input[type="text"] { flex-grow: 2; }
        .menu-editor-item input[type="number"] { flex-grow: 1; max-width: 100px; }
        .btn-remove { background: #ffebee; color: #d32f2f; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; line-height: 1;}
        
        .btn-add { background: var(--bg-light); color: var(--text-main); border: 2px dashed var(--border-color); width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; transition: all 0.3s;}
        .btn-add:hover { border-color: var(--orange); color: var(--orange); background: #fff5f0;}

        .btn-submit { background: var(--orange); color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 107, 53, 0.3); transition: transform 0.2s;}
        .btn-submit:hover { transform: translateY(-2px); background: #e55a2b; }
        .btn-submit:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; transform: none;}

        #result-link-box { display: none; margin-top: 20px; padding: 15px; background: #e8f5e9; border: 1px solid #c8e6c9; border-radius: 8px; word-break: break-all; color: #2e7d32;}

        /* --- å…¶ä»–åˆ†é æ¨£å¼ (é…åˆæ·ºè‰²ä¸»é¡Œèª¿æ•´) --- */
        .order-card { background: var(--card-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);}
        .order-info h4 { margin: 0 0 5px 0; color: var(--text-main); }
        .order-info p { margin: 0; font-size: 0.9rem; color: var(--text-sub); }
        
        .ledger-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); background: var(--card-bg);}
        .pay-status { padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; border: 1px solid var(--text-sub); color: var(--text-sub); background: #fff;}
        .pay-status.paid { background: var(--success-green, #4CAF50); color: white; border: none; font-weight: bold; }

        .prompter-box { background: var(--card-bg); padding: 20px; border-radius: 10px; min-height: 300px; border: 1px solid var(--border-color);}
        .prompter-line { font-size: 2rem; margin-bottom: 15px; border-bottom: 2px dashed var(--border-color); padding-bottom: 10px; color: var(--text-main); font-weight: bold;}
        .prompter-qty { color: var(--orange); font-weight: 900; font-size: 3rem; float: right;}

        /* åº•éƒ¨å°è¦½åˆ— */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--nav-bg); display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); border-top: 1px solid var(--border-color);}
        .nav-item { text-align: center; color: var(--text-sub); cursor: pointer; flex: 1; transition: color 0.3s;}
        .nav-item.active { color: var(--orange); }
        .nav-icon { font-size: 1.6rem; display: block; margin-bottom: 4px;}
        .nav-text { font-size: 0.7rem; font-weight: bold;}

    </style>
</head>
<body>

    <div class="dashboard-header">
        <h2 style="margin:0; color: var(--text-main);">ğŸ¤´ é£Ÿç¥æ§åˆ¶ä¸­å¿ƒ</h2>
        <div class="total-stats">
            <div class="stat-box">
                <div class="num" id="total-count">0</div>
                <div class="label">ç¸½ä»½æ•¸</div>
            </div>
            <div class="stat-box">
                <div class="num" id="total-price">$0</div>
                <div class="label">ç¸½é‡‘é¡</div>
            </div>
        </div>
    </div>

    <div id="tab-create" class="tab-content active">
        <h3 class="tab-title">ğŸš€ å»ºç«‹æ–°åœ˜è³¼ä¾¿ç•¶ç«™</h3>
        <div class="card-box">
            
            <div class="input-group">
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee;">
                    <label style="font-weight:bold; color:var(--text-sub);">ğŸ“‚ å¾ä¾¿ç•¶æ± å¿«é€Ÿè¼‰å…¥ (æœªå¯¦ä½œ)</label>
                    <select id="pool-select" class="input-field" disabled>
                        <option value="">(åŠŸèƒ½é–‹ç™¼ä¸­)</option>
                    </select>
                </div>

                <label for="menu-title">åº—å®¶åç¨±</label>
                <input type="text" id="menu-title" class="input-field" placeholder="ä¾‹å¦‚ï¼šé€±äº”åƒç‚¸é›">
            </div>

            <div style="background:#fff3e0; padding:15px; border-radius:8px; margin-bottom:20px; border:1px dashed var(--orange);">
                <label style="font-weight:bold; color:var(--orange);">âœ¨ æ‡¶äººæ¨¡å¼ï¼šæ™ºæ…§è²¼ä¸Š</label>
                <p style="font-size:0.8rem; margin:5px 0; color:#666;">
                    è«‹è²¼ä¸Šæ–‡å­— (æ ¼å¼ï¼šèœå åƒ¹æ ¼ï¼Œä¸€è¡Œä¸€å€‹)
                </p>
                <textarea id="smart-paste-area" class="input-field" rows="4" placeholder="ç¯„ä¾‹ï¼š
æ‹›ç‰Œæ’éª¨é£¯ 100
é…¥ç‚¸é›è…¿é£¯ 110"></textarea>
                <button class="btn-add" style="background:var(--orange); color:white; border:none; margin-top:10px;" onclick="smartParse()">âš¡ï¸ ä¸€éµè½‰æ›ç‚ºèœå–®</button>
            </div>
            
            <label style="display:block; margin-bottom:8px; font-weight:bold;">èœå–®é …ç›® (å¯æ‰‹å‹•èª¿æ•´)</label>
            <div id="menu-editor-container"></div>
            
            <button class="btn-add" onclick="addMenuItem()">+ æ‰‹å‹•æ–°å¢ä¸€åˆ—</button>
            <button class="btn-submit" id="btn-publish" onclick="publishMenu()">ç¢ºèªç™¼å¸ƒï¼Œç”¢ç”Ÿé€£çµï¼</button>

            <div id="result-link-box"></div>
        </div>
    </div>

    <div id="tab-group" class="tab-content">
        <h3 class="tab-title">ğŸ“‹ å³æ™‚è¨‚å–®ç›£æ§</h3>
        <div id="order-list" class="card-box" style="min-height:200px; color: var(--text-sub);">
            è«‹å…ˆé¸æ“‡è¦ç›£æ§çš„åœ˜è³¼æ´»å‹•... (æ­¤åŠŸèƒ½å°‡åœ¨ä¸‹ä¸€ç‰ˆå®Œå–„)
        </div>
    </div>

    <div id="tab-ledger" class="tab-content">
        <h3 class="tab-title">ğŸ’° æ”¶æ¬¾ç›´è¦ºå¸³æœ¬</h3>
        <div id="ledger-list" class="card-box" style="padding:0;">
            <div class="ledger-row">
                <div><span style="font-weight:bold;">ç¯„ä¾‹å°æ˜</span><span style="color:var(--text-sub); margin-left:10px;">$100</span></div>
                <div class="pay-status paid">å·²ä»˜</div>
            </div>
        </div>
    </div>

    <div id="tab-prompter" class="tab-content">
        <h3 class="tab-title">ğŸ“ é›»è©±æè©æ©Ÿ</h3>
        <div class="prompter-box" id="prompter-list">
             <div class="prompter-line"><span>æ‹›ç‰Œæ’éª¨é£¯</span><span class="prompter-qty">5</span></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('tab-create', this)">
            <span class="nav-icon">ğŸš€</span><span class="nav-text">ç™¼å¸ƒ</span>
        </div>
        <div class="nav-item" onclick="switchTab('tab-group', this)">
            <span class="nav-icon">ğŸ“‹</span><span class="nav-text">ç›£æ§</span>
        </div>
        <div class="nav-item" onclick="switchTab('tab-ledger', this)">
            <span class="nav-icon">ğŸ’°</span><span class="nav-text">å¸³æœ¬</span>
        </div>
        <div class="nav-item" onclick="switchTab('tab-prompter', this)">
            <span class="nav-icon">ğŸ“</span><span class="nav-text">æè©</span>
        </div>
    </div>

<script>
    // âš ï¸ è«‹å¡«å…¥å‰›å‰›è¤‡è£½çš„ /exec çµå°¾ç¶²å€ (çµ•å°ä¸èƒ½æ˜¯ /library/)
    const SCRIPT_URL = "https://script.google.com/macros/s/æ‚¨çš„æ­£ç¢ºID/exec"; 
    
    // âš ï¸ User é é¢ç¶²å€
    const USER_PAGE_URL = "https://lunchfood.netlify.app/"; 

    window.onload = function() { fetchPool(); };

    // 1. æ™ºæ…§è²¼ä¸Š (å·²ä¿®å¾©)
    function smartParse() {
        const rawText = document.getElementById('smart-paste-area').value;
        if (!rawText.trim()) { alert("è«‹å…ˆè²¼ä¸Šæ–‡å­—ï¼"); return; }
        const lines = rawText.split('\n');
        
        document.getElementById('menu-editor-container').innerHTML = ''; // æ¸…ç©º
        
        let count = 0;
        lines.forEach(line => {
            let cleanLine = line.trim();
            if (!cleanLine) return;
            // æŠ“å–æœ€å¾Œä¸€å€‹æ•¸å­—ç•¶åƒ¹æ ¼
            const priceMatch = cleanLine.match(/(\d+)/g); 
            if (priceMatch) {
                const price = priceMatch[priceMatch.length - 1];
                let name = cleanLine.replace(price, '').replace(/[$.å…ƒNT...:ï¼š]/g, '').trim();
                if (name && price) {
                    addMenuItem(name, price);
                    count++;
                }
            }
        });
        if(count === 0) alert("ç„¡æ³•è¾¨è­˜ï¼Œè«‹ç¢ºèªæ ¼å¼ (ä¾‹å¦‚ï¼šæ’éª¨é£¯ 100)");
        else document.getElementById('smart-paste-area').value = '';
    }

    // 2. ç™¼å¸ƒèœå–® (å·²ä¿®å¾©)
    function publishMenu() {
        const title = document.getElementById('menu-title').value;
        const saveToPool = document.getElementById('save-pool-check').checked;
        const items = [];
        
        document.querySelectorAll('.menu-editor-item').forEach(el => {
            const name = el.querySelector('.item-name').value;
            const price = el.querySelector('.item-price').value;
            if (name && price) items.push({ name, price: parseInt(price) });
        });

        if (!title || items.length === 0) { alert("è«‹è¼¸å…¥åº—åä¸¦è‡³å°‘æ–°å¢ä¸€é“èœï¼"); return; }

        const btn = document.getElementById('btn-publish');
        btn.disabled = true;
        btn.innerText = "é€£ç·šä¸­...";

        fetch(SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify({ action: 'create_menu', title, items, saveToPool })
        })
        .then(res => res.json())
        .then(json => {
            if(json.status === 'success') {
                btn.innerText = "ç™¼å¸ƒå®Œæˆï¼";
                const link = `${USER_PAGE_URL}?id=${encodeURIComponent(json.menuId)}`;
                document.getElementById('result-link-box').style.display = 'block';
                document.getElementById('result-link-box').innerHTML = 
                    `âœ… ç™¼å¸ƒæˆåŠŸï¼<br><a href="${link}" target="_blank" style="font-size:1.2rem;color:red;">${link}</a>`;
                if(saveToPool) setTimeout(fetchPool, 1000);
            } else {
                alert("éŒ¯èª¤ï¼š" + json.message);
                btn.disabled = false;
            }
        })
        .catch(err => {
            alert("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²å€æ˜¯å¦æ­£ç¢º (å¿…é ˆæ˜¯ /exec çµå°¾)");
            btn.disabled = false;
        });
    }

    // 3. è®€å–ä¾¿ç•¶æ± 
    function fetchPool() {
        const select = document.getElementById('pool-select');
        fetch(`${SCRIPT_URL}?action=get_pool`)
        .then(res => res.json())
        .then(data => {
            if(data.status === 'success') {
                select.innerHTML = '<option value="">-- å¿«é€Ÿè¼‰å…¥ --</option>';
                data.data.forEach((shop, i) => {
                    let opt = new Option(shop.title, i);
                    opt.dataset.items = JSON.stringify(shop.items);
                    select.add(opt);
                });
                select.disabled = false;
            }
        });
    }

    function loadFromPool() {
        const select = document.getElementById('pool-select');
        if(!select.value) return;
        const opt = select.options[select.selectedIndex];
        document.getElementById('menu-title').value = opt.text;
        document.getElementById('menu-editor-container').innerHTML = '';
        JSON.parse(opt.dataset.items).forEach(item => addMenuItem(item.name, item.price));
    }

    function addMenuItem(name='', price='') {
        const div = document.createElement('div');
        div.className = 'menu-editor-item';
        div.innerHTML = `<input type="text" class="input-field item-name" value="${name}" placeholder="èœå">
                         <input type="number" class="input-field item-price" value="${price}" placeholder="åƒ¹æ ¼">
                         <button class="btn-remove" onclick="this.parentElement.remove()">Ã—</button>`;
        document.getElementById('menu-editor-container').appendChild(div);
    }
    
    function switchTab(id, el) { /* ä¿æŒåŸæ¨£ */ 
        document.querySelectorAll('.tab-content').forEach(e=>e.classList.remove('active'));
        document.getElementById(id).classList.add('active');
    }
</script>
</body>