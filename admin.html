<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš¡ï¸ é£Ÿç¥æ§åˆ¶ä¸­å¿ƒ</title>
    <style>
        /* --- ğŸ¨ æ·ºè‰²ä¸»é¡Œé…è‰² --- */
        :root {
            --bg-light: #f4f7f6;      /* æ•´é«”èƒŒæ™¯ */
            --card-bg: #ffffff;       /* å¡ç‰‡èƒŒæ™¯ */
            --text-main: #333333;     /* ä¸»è¦æ–‡å­— */
            --text-sub: #666666;      /* æ¬¡è¦æ–‡å­— */
            --gold: #F7C800;          /* å¼·èª¿è‰² (é‡‘) */
            --orange: #FF6B35;        /* å¼·èª¿è‰² (æ©˜) */
            --header-bg: #ffffff;     /* æ¨™é¡Œåˆ—èƒŒæ™¯ */
            --nav-bg: #ffffff;        /* å°è¦½åˆ—èƒŒæ™¯ */
            --border-color: #e0e0e0;  /* é‚Šæ¡†é¡è‰² */
        }

        body {
            font-family: 'PingFang TC', 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-main);
            margin: 0; padding: 0;
            padding-bottom: 80px;
        }

        /* é ‚éƒ¨æ•¸æ“šåˆ— */
        .dashboard-header {
            background: var(--header-bg);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--orange);
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .total-stats { display: flex; justify-content: space-around; margin-top: 15px; }
        .stat-box .num { font-size: 1.8rem; font-weight: 800; color: var(--orange); }
        .stat-box .label { font-size: 0.9rem; color: var(--text-sub); }

        /* é€šç”¨å®¹å™¨èˆ‡å¡ç‰‡ */
        .tab-content { display: none; padding: 20px; animation: fadeIn 0.3s; max-width: 800px; margin: 0 auto; }
        .tab-content.active { display: block; }
        @keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
        .card-box { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; }
        h3.tab-title { color: var(--orange); margin-top: 0; border-left: 4px solid var(--orange); padding-left: 10px;}
<div style="margin: 15px 0;">
    <input type="checkbox" id="save-pool-check" checked>
    <label for="save-pool-check" style="cursor:pointer; color:var(--text-main);">åŒæ™‚å°‡æ­¤èœå–®å­˜å…¥ã€Œä¾¿ç•¶æ± ã€ï¼Œä¸‹æ¬¡å¯ç›´æ¥é¸ç”¨</label>
</div>
        /* --- æ–°å¢ï¼šç™¼å¸ƒåœ˜è³¼ (Create Menu) --- */
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--text-main); }
        .input-field { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; box-sizing: border-box; font-size: 1rem; transition: border 0.3s;}
        .input-field:focus { border-color: var(--orange); outline: none; }
        
        .menu-editor-item { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
        .menu-editor-item input[type="text"] { flex-grow: 2; }
        .menu-editor-item input[type="number"] { flex-grow: 1; max-width: 100px; }
        .btn-remove { background: #ffebee; color: #d32f2f; border: none; padding: 10px; border-radius: 8px; cursor: pointer; font-size: 1.2rem; line-height: 1;}
        
        .btn-add { background: var(--bg-light); color: var(--text-main); border: 2px dashed var(--border-color); width: 100%; padding: 12px; border-radius: 8px; cursor: pointer; font-weight: bold; margin-bottom: 20px; transition: all 0.3s;}
        .btn-add:hover { border-color: var(--orange); color: var(--orange); background: #fff5f0;}

        .btn-submit { background: var(--orange); color: white; width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1.2rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 10px rgba(255, 107, 53, 0.3); transition: transform 0.2s;}
        .btn-submit:hover { transform: translateY(-2px); background: #e55a2b; }
        .btn-submit:disabled { background: #ccc; cursor: not-allowed; box-shadow: none; transform: none;}

        #result-link-box { display: none; margin-top: 20px; padding: 15px; background: #e8f5e9; border: 1px solid #c8e6c9; border-radius: 8px; word-break: break-all; color: #2e7d32;}

        /* --- å…¶ä»–åˆ†é æ¨£å¼ (é…åˆæ·ºè‰²ä¸»é¡Œèª¿æ•´) --- */
        .order-card { background: var(--card-bg); padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; border: 1px solid var(--border-color);}
        .order-info h4 { margin: 0 0 5px 0; color: var(--text-main); }
        .order-info p { margin: 0; font-size: 0.9rem; color: var(--text-sub); }
        
        .ledger-row { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid var(--border-color); background: var(--card-bg);}
        .pay-status { padding: 5px 15px; border-radius: 20px; cursor: pointer; font-size: 0.8rem; border: 1px solid var(--text-sub); color: var(--text-sub); background: #fff;}
        .pay-status.paid { background: var(--success-green, #4CAF50); color: white; border: none; font-weight: bold; }

        .prompter-box { background: var(--card-bg); padding: 20px; border-radius: 10px; min-height: 300px; border: 1px solid var(--border-color);}
        .prompter-line { font-size: 2rem; margin-bottom: 15px; border-bottom: 2px dashed var(--border-color); padding-bottom: 10px; color: var(--text-main); font-weight: bold;}
        .prompter-qty { color: var(--orange); font-weight: 900; font-size: 3rem; float: right;}

        /* åº•éƒ¨å°è¦½åˆ— */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: var(--nav-bg); display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); border-top: 1px solid var(--border-color);}
        .nav-item { text-align: center; color: var(--text-sub); cursor: pointer; flex: 1; transition: color 0.3s;}
        .nav-item.active { color: var(--orange); }
        .nav-icon { font-size: 1.6rem; display: block; margin-bottom: 4px;}
        .nav-text { font-size: 0.7rem; font-weight: bold;}

    </style>
</head>
<body>

    <div class="dashboard-header">
        <h2 style="margin:0; color: var(--text-main);">ğŸ¤´ é£Ÿç¥æ§åˆ¶ä¸­å¿ƒ</h2>
        <div class="total-stats">
            <div class="stat-box">
                <div class="num" id="total-count">0</div>
                <div class="label">ç¸½ä»½æ•¸</div>
            </div>
            <div class="stat-box">
                <div class="num" id="total-price">$0</div>
                <div class="label">ç¸½é‡‘é¡</div>
            </div>
        </div>
    </div>

    <div id="tab-create" class="tab-content active">
        <h3 class="tab-title">ğŸš€ å»ºç«‹æ–°åœ˜è³¼ä¾¿ç•¶ç«™</h3>
        <div class="card-box">
            
            <div class="input-group">
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #eee;">
                    <label style="font-weight:bold; color:var(--text-sub);">ğŸ“‚ å¾ä¾¿ç•¶æ± å¿«é€Ÿè¼‰å…¥ (æœªå¯¦ä½œ)</label>
                    <select id="pool-select" class="input-field" disabled>
                        <option value="">(åŠŸèƒ½é–‹ç™¼ä¸­)</option>
                    </select>
                </div>

                <label for="menu-title">åº—å®¶åç¨±</label>
                <input type="text" id="menu-title" class="input-field" placeholder="ä¾‹å¦‚ï¼šé€±äº”åƒç‚¸é›">
            </div>

            <div style="background:#fff3e0; padding:15px; border-radius:8px; margin-bottom:20px; border:1px dashed var(--orange);">
                <label style="font-weight:bold; color:var(--orange);">âœ¨ æ‡¶äººæ¨¡å¼ï¼šæ™ºæ…§è²¼ä¸Š</label>
                <p style="font-size:0.8rem; margin:5px 0; color:#666;">
                    è«‹è²¼ä¸Šæ–‡å­— (æ ¼å¼ï¼šèœå åƒ¹æ ¼ï¼Œä¸€è¡Œä¸€å€‹)
                </p>
                <textarea id="smart-paste-area" class="input-field" rows="4" placeholder="ç¯„ä¾‹ï¼š
æ‹›ç‰Œæ’éª¨é£¯ 100
é…¥ç‚¸é›è…¿é£¯ 110"></textarea>
                <button class="btn-add" style="background:var(--orange); color:white; border:none; margin-top:10px;" onclick="smartParse()">âš¡ï¸ ä¸€éµè½‰æ›ç‚ºèœå–®</button>
            </div>
            
            <label style="display:block; margin-bottom:8px; font-weight:bold;">èœå–®é …ç›® (å¯æ‰‹å‹•èª¿æ•´)</label>
            <div id="menu-editor-container"></div>
            
            <button class="btn-add" onclick="addMenuItem()">+ æ‰‹å‹•æ–°å¢ä¸€åˆ—</button>
            <button class="btn-submit" id="btn-publish" onclick="publishMenu()">ç¢ºèªç™¼å¸ƒï¼Œç”¢ç”Ÿé€£çµï¼</button>

            <div id="result-link-box"></div>
        </div>
    </div>

    <div id="tab-group" class="tab-content">
        <h3 class="tab-title">ğŸ“‹ å³æ™‚è¨‚å–®ç›£æ§</h3>
        <div id="order-list" class="card-box" style="min-height:200px; color: var(--text-sub);">
            è«‹å…ˆé¸æ“‡è¦ç›£æ§çš„åœ˜è³¼æ´»å‹•... (æ­¤åŠŸèƒ½å°‡åœ¨ä¸‹ä¸€ç‰ˆå®Œå–„)
        </div>
    </div>

    <div id="tab-ledger" class="tab-content">
        <h3 class="tab-title">ğŸ’° æ”¶æ¬¾ç›´è¦ºå¸³æœ¬</h3>
        <div id="ledger-list" class="card-box" style="padding:0;">
            <div class="ledger-row">
                <div><span style="font-weight:bold;">ç¯„ä¾‹å°æ˜</span><span style="color:var(--text-sub); margin-left:10px;">$100</span></div>
                <div class="pay-status paid">å·²ä»˜</div>
            </div>
        </div>
    </div>

    <div id="tab-prompter" class="tab-content">
        <h3 class="tab-title">ğŸ“ é›»è©±æè©æ©Ÿ</h3>
        <div class="prompter-box" id="prompter-list">
             <div class="prompter-line"><span>æ‹›ç‰Œæ’éª¨é£¯</span><span class="prompter-qty">5</span></div>
        </div>
    </div>

    <div class="bottom-nav">
        <div class="nav-item active" onclick="switchTab('tab-create', this)">
            <span class="nav-icon">ğŸš€</span><span class="nav-text">ç™¼å¸ƒ</span>
        </div>
        <div class="nav-item" onclick="switchTab('tab-group', this)">
            <span class="nav-icon">ğŸ“‹</span><span class="nav-text">ç›£æ§</span>
        </div>
        <div class="nav-item" onclick="switchTab('tab-ledger', this)">
            <span class="nav-icon">ğŸ’°</span><span class="nav-text">å¸³æœ¬</span>
        </div>
        <div class="nav-item" onclick="switchTab('tab-prompter', this)">
            <span class="nav-icon">ğŸ“</span><span class="nav-text">æè©</span>
        </div>
    </div>

<script>
    // âš ï¸ é€™è£¡ä¹Ÿè¦å¡«å…¥æ­£ç¢ºçš„ GAS ç¶²å€
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwxqBOM8VD1mZwXGfctdItrDxWs8AIxjZ38Ye9BgEPvmBzp_V2SSCaXAAAbt_fCiYI/exec"; 

    let currentMenuId = ""; // ç”¨ä¾†å­˜ç¾åœ¨æ˜¯å“ªå€‹èœå–®
    let selectedItem = "";
    let selectedPrice = 0;

    // é é¢è¼‰å…¥æ™‚ï¼ŒæŠ“å–ç¶²å€ä¸Šçš„ ID
    window.onload = function() {
        const urlParams = new URLSearchParams(window.location.search);
        currentMenuId = urlParams.get('id');

        if (!currentMenuId) {
            document.querySelector('.menu-section').innerHTML = "<h3>âš ï¸ ç„¡æ³•è¼‰å…¥èœå–®</h3><p>ç¶²å€ç¼ºå°‘ IDï¼Œè«‹ç”±ç®¡ç†å“¡æä¾›çš„é€£çµé€²å…¥ã€‚</p>";
            return;
        }

        loadMenu(currentMenuId);
    };

    // å‘ GAS è«‹æ±‚èœå–®è³‡æ–™
    function loadMenu(menuId) {
        document.querySelector('.menu-section').innerHTML = "<h3>â³ èœå–®è¼‰å…¥ä¸­...</h3>";
        
        fetch(`${SCRIPT_URL}?action=get_menu&id=${encodeURIComponent(menuId)}`)
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                // æ›´æ–°æ¨™é¡Œ
                document.querySelector('.header h1').innerText = `ğŸ± ä»Šå¤©åƒï¼š${data.title.split('_')[1]}`; // å»æ‰æ™‚é–“æˆ³è¨˜
                
                // å‹•æ…‹ç”¢ç”Ÿèœå–® HTML
                const menuContainer = document.querySelector('.menu-section');
                menuContainer.innerHTML = '<h3>1. é¸æ“‡é¤é»</h3>'; // æ¸…ç©º loading
                
                data.items.forEach(item => {
                    const div = document.createElement('div');
                    div.className = 'menu-item';
                    div.onclick = function() { selectFood(item.name, item.price, this); };
                    div.innerHTML = `<div>${item.name}</div><div class="price">$${item.price}</div>`;
                    menuContainer.appendChild(div);
                });
            } else {
                document.querySelector('.menu-section').innerHTML = `<h3>âŒ éŒ¯èª¤</h3><p>${data.message}</p>`;
            }
        })
        .catch(err => {
            document.querySelector('.menu-section').innerHTML = "<h3>âŒ é€£ç·šå¤±æ•—</h3><p>è«‹æª¢æŸ¥ç¶²è·¯</p>";
        });
    }

    function selectFood(name, price, element) {
        document.querySelectorAll('.menu-item').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');
        selectedItem = name;
        selectedPrice = price;
    }

    function submitOrder() {
        const name = document.getElementById('username').value;
        const note = document.getElementById('note').value;
        const btn = document.getElementById('btnSubmit');

        if (!name) { alert("è«‹è¼¸å…¥åå­—ï¼"); return; }
        if (!selectedItem) { alert("è«‹é¸æ“‡ä¸€ä»½é¤é»ï¼"); return; }

        btn.disabled = true;
        btn.innerText = "è³‡æ–™å‚³é€ä¸­...";

        const orderData = {
            action: "order", // å‘Šè¨´å¾Œç«¯é€™æ˜¯è¨‚å–®
            menuId: currentMenuId, // é‡è¦ï¼å‘Šè¨´å¾Œç«¯è¦å¯«å…¥å“ªå€‹åˆ†é 
            name: name,
            item: selectedItem,
            price: selectedPrice,
            note: note
        };

        // é€™è£¡ä¸éœ€è¦ no-corsï¼Œå› ç‚ºå¾Œç«¯ç¾åœ¨æ”¯æ´ CORS å›å‚³
        fetch(SCRIPT_URL, {
            method: "POST",
            body: JSON.stringify(orderData)
        }).then(res => res.json())
        .then(json => {
            if (json.status === "success") {
                document.querySelector('.input-section').style.display = 'none';
                document.querySelector('.menu-section').style.display = 'none';
                document.getElementById('success-msg').style.display = 'block';
            } else {
                alert("è¨‚è³¼å¤±æ•—ï¼š" + json.message);
                btn.disabled = false;
            }
        }).catch(error => {
            alert("ç™¼ç”ŸéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦");
            btn.disabled = false;
        });
    }
</script>

</body>


